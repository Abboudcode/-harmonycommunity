<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <title>Stories – Harmony Community</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Read example stories on Harmony Community." />

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      --bg: #f5f7fb;
      --bg-card: #ffffff;
      --primary: #4b6fff;
      --primary-soft: #e2e7ff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-soft: #e5e7eb;
      --accent: #10b981;
      --danger: #ef4444;
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.12);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #eef2ff, #f9fafb 40%);
      color: var(--text-main);
      line-height: 1.6;
    }

    a { color: inherit; text-decoration: none; }

    .page { min-height: 100vh; display: flex; flex-direction: column; }

    .max-w { max-width: 1120px; margin: 0 auto; padding: 0 1.25rem; }

    /* HEADER / NAV */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(18px);
      background: linear-gradient(180deg, #050817, #0f172a);
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.8rem 0;
      gap: 1rem;
    }

    .nav-left { display: flex; align-items: center; gap: 0.5rem; }
    .logo-wrapper { display: flex; align-items: center; }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 0.95rem;
      color: #e5e7eb;
    }

    .nav-links a {
      padding: 0.3rem 0.7rem;
      border-radius: 999px;
      transition: background 0.2s, color 0.2s;
    }

    .nav-links a:hover { background: rgba(148, 163, 184, 0.22); color: #ffffff; }
    .nav-links a.active { background: rgba(129, 140, 248, 0.35); color: #ffffff; }

    .nav-right { display: flex; align-items: center; gap: 0.75rem; }

    .nav-ghost {
      font-size: 0.9rem;
      color: #cbd5f5;
      white-space: nowrap;
    }

    .language-select {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.8);
      color: #e5e7eb;
      font-size: 0.8rem;
      padding: 0.25rem 0.7rem;
      outline: none;
      cursor: pointer;
    }

    .language-select option { color: #111827; background: #ffffff; }

    @media (max-width: 720px) { .nav-links { display: none; } }

    /* LAYOUT */
    main { padding: 2.6rem 0 2rem; }

    .page-header { text-align: center; margin-bottom: 1.8rem; }
    .page-header h1 { font-size: 1.9rem; margin-bottom: 0.45rem; }
    .page-header p {
      color: var(--text-muted);
      font-size: 0.95rem;
      max-width: 680px;
      margin: 0 auto;
    }

    .filters-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.8rem;
    }

    .filter-pill {
      padding: 0.2rem 0.9rem;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      font-size: 0.85rem;
      color: #4b5563;
      cursor: pointer;
      transition: background 0.15s, color 0.15s, border-color 0.15s;
    }

    .filter-pill.active {
      background: #4f46e5;
      border-color: #4f46e5;
      color: #ffffff;
    }

    /* STORIES GRID */
    .stories-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 1.15rem;
      padding-bottom: 2rem;
    }

    @media (max-width: 1020px) { .stories-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    @media (max-width: 720px) { .stories-grid { grid-template-columns: minmax(0, 1fr); } }

    .story-card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 1.2rem 1.15rem;
      border: 1px solid var(--border-soft);
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.04);
      transition: box-shadow 0.16s ease, transform 0.16s ease, border-color 0.16s ease;
      height: 100%;
      cursor: pointer; /* makes it obvious it’s clickable */
    }

    .story-card:hover {
      box-shadow: var(--shadow-soft);
      transform: translateY(-2px);
      border-color: #e5e7eb;
    }

    .story-card:focus-visible {
      outline: 3px solid rgba(79, 70, 229, 0.35);
      outline-offset: 4px;
    }

    .story-category {
      display: inline-flex;
      align-items: center;
      font-size: 0.78rem;
      font-weight: 500;
      border-radius: 999px;
      padding: 0.18rem 0.7rem;
      background: #eef2ff;
      color: #4f46e5;
      margin-bottom: 0.35rem;
    }

    .story-title { font-size: 1rem; font-weight: 600; margin-bottom: 0.3rem; }
    .story-excerpt { font-size: 0.9rem; color: #374151; margin-bottom: 0.7rem; }

    .story-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: #6b7280;
    }

    .story-footer span { display: inline-flex; align-items: center; gap: 0.3rem; }

    .story-footer .dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: #d1d5db;
      display: inline-block;
    }

    .empty-state { text-align: center; padding: 3rem 1rem; color: var(--text-muted); }

    footer {
      padding: 1rem 0 1.5rem;
      font-size: 0.8rem;
      color: var(--text-muted);
      text-align: center;
      margin-top: auto;
    }

    @media (max-width: 640px) {
      main { padding-top: 2.2rem; }
      .nav { padding: 0.6rem 0; }
    }

    /* Minimal RTL support */
    html[dir="rtl"] .story-card,
    html[dir="rtl"] .story-card p,
    html[dir="rtl"] .story-title { text-align: start; }

    html[dir="rtl"] .story-footer { direction: rtl; }
  </style>
</head>

<body>
<div class="page">
  <!-- HEADER -->
  <header>
    <div class="max-w nav">
      <div class="nav-left">
        <div class="logo-wrapper">
          <!-- Logo -->
          <svg width="180" height="40" viewBox="0 0 180 40" xmlns="http://www.w3.org/2000/svg" aria-label="Harmony logo" role="img">
            <path d="M10 22 C25 5, 55 5, 70 22" fill="none" stroke="#40cbb4" stroke-width="3" stroke-linecap="round" />
            <path d="M12 22 L22 22 L27 15 L33 30 L38 22 L68 22" fill="none" stroke="#f5c451" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
            <text x="78" y="27" font-family="Inter, system-ui, sans-serif" font-size="18" font-weight="600" fill="#ffffff">Harmony</text>
          </svg>
        </div>
      </div>

      <nav class="nav-links">
        <a href="index.html" data-en="Home" data-ar="الرئيسية">Home</a>
        <a href="stories.html" class="active" data-en="Stories" data-ar="القصص">Stories</a>
        <a href="share.html" data-en="Share a Story" data-ar="شارك قصة">Share a Story</a>
        <a href="signin.html" data-en="Sign In" data-ar="تسجيل الدخول">Sign In</a>
        <a href="about.html" data-en="About" data-ar="عن هارموني">About</a>
        <a href="faq.html" data-en="FAQ" data-ar="الأسئلة الشائعة">FAQ</a>
        <a href="contact.html" data-en="Contact" data-ar="اتصال">Contact</a>
      </nav>

      <div class="nav-right">
        <select id="language-select" class="language-select" aria-label="Choose language">
          <option value="en">English</option>
          <option value="ar">العربية</option>
        </select>
        <div class="nav-ghost" id="nav-auth-label" data-en="Not signed in" data-ar="غير مسجّل الدخول">Not signed in</div>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main>
    <div class="max-w">
      <div class="page-header">
        <h1 data-en="Stories" data-ar="القصص">Stories</h1>
        <p data-en="Read example stories from the Harmony community preview." data-ar="اقرأ قصصاً تجريبية من معاينة مجتمع هارموني.">
          Read example stories from the Harmony community preview.
        </p>
      </div>

      <div class="filters-row">
        <button class="filter-pill active" data-filter="all" data-en="All" data-ar="الكل">All</button>
        <button class="filter-pill" data-filter="kids" data-en="Kids" data-ar="أطفال">Kids</button>
        <button class="filter-pill" data-filter="teens" data-en="Teens" data-ar="مراهقين">Teens</button>
        <button class="filter-pill" data-filter="marriage" data-en="Marriage" data-ar="زواج">Marriage</button>
        <button class="filter-pill" data-filter="inlaws" data-en="In-laws" data-ar="الأهل">In-laws</button>
        <button class="filter-pill" data-filter="money" data-en="Money" data-ar="المال">Money</button>
        <button class="filter-pill" data-filter="finance" data-en="Finance" data-ar="التمويل">Finance</button>
      </div>

      <!-- STORIES RENDER TARGET -->
      <div id="stories-grid" class="stories-grid"></div>

      <div id="empty-state" class="empty-state" style="display:none;"
           data-en="No stories found for this category."
           data-ar="لا توجد قصص لهذه الفئة حالياً.">
        No stories found for this category.
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer>Harmony Community © 2025</footer>
</div>

<!-- Supabase client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  (function () {
    const LANG_KEY = 'harmony_lang';

    const langSelect = document.getElementById('language-select');
    const navAuthLabel = document.getElementById('nav-auth-label');

    function getInitialLang() {
      try {
        const saved = localStorage.getItem(LANG_KEY);
        if (saved === 'ar' || saved === 'en') return saved;
      } catch (e) {}
      return 'en';
    }

    function applyLanguage(lang) {
      const elements = document.querySelectorAll('[data-en]');
      elements.forEach(el => {
        const en = el.getAttribute('data-en');
        const ar = el.getAttribute('data-ar') || en;
        el.innerHTML = (lang === 'ar') ? ar : en;
      });

      document.documentElement.lang = (lang === 'ar') ? 'ar' : 'en';
      document.documentElement.dir  = (lang === 'ar') ? 'rtl' : 'ltr';
    }

    // === Supabase setup (same project) ===
    const SUPABASE_URL = 'https://tnohzvrpqiaiupwyaxcp.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_BkvdSI8x7RxczomMIRAbOA_MLTw8g8K';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let currentLang = getInitialLang();
    applyLanguage(currentLang);

    if (langSelect) {
      langSelect.value = currentLang;
      langSelect.addEventListener('change', () => {
        currentLang = langSelect.value;
        try { localStorage.setItem(LANG_KEY, currentLang); } catch (e) {}
        applyLanguage(currentLang);
        refreshUserLabel(currentLang);
        renderStories(activeFilter);
      });
    }

    async function refreshUserLabel(langOverride) {
      const lang = langOverride || currentLang;

      const { data, error } = await supabase.auth.getUser();
      if (error || !data || !data.user) {
        if (navAuthLabel) {
          const en = navAuthLabel.getAttribute('data-en') || 'Not signed in';
          const ar = navAuthLabel.getAttribute('data-ar') || en;
          navAuthLabel.textContent = (lang === 'ar') ? ar : en;
        }
        return;
      }

      const user = data.user;
      const meta = user.user_metadata || {};
      const displayName = meta.display_name || user.email;
      const alwaysAnon = !!meta.always_anonymous;

      let label;
      if (alwaysAnon) {
        label = (lang === 'ar')
          ? 'مسجّل: مجهول (الاسم مخفي)'
          : 'Signed in: Anonymous (name hidden)';
      } else {
        label = (lang === 'ar')
          ? 'مسجّل: ' + displayName
          : 'Signed in: ' + displayName;
      }

      if (navAuthLabel) navAuthLabel.textContent = label;
    }

    const exampleStories = [
      {
        id: 1,
        category: 'kids',
        categoryLabelEn: 'Kids',
        categoryLabelAr: 'أطفال',
        titleEn: '“I feel like I’m failing as a parent”',
        titleAr: '«حاسس إني عم أفشل كأب/أم»',
        excerptEn: 'My 8-year-old has become so clingy and emotional. Some days I lose my patience and shout, then cry after she sleeps...',
        excerptAr: 'بنتي عمرها ٨ سنين صارت متعلّقة فيّ وعصبيّة زيادة. أحياناً بفقد أعصابي وبصرخ، وبالليل بعد ما تنام ببكي من الندم...',
        relatedEn: '22 people related',
        relatedAr: '٢٢ شخص حسّوا بنفس الشي',
        repliesEn: '5 gentle replies',
        repliesAr: '٥ ردود لطيفة',
      },
      {
        id: 2,
        category: 'marriage',
        categoryLabelEn: 'Marriage',
        categoryLabelAr: 'زواج',
        titleEn: '“My spouse and I stopped talking”',
        titleAr: '«أنا وشريكي وقفنا نحكي»',
        excerptEn: 'It feels like we live in the same house but we are strangers. Every conversation becomes an argument...',
        excerptAr: 'حسّيت كأنو عايشين بنفس البيت بس غرباء. كل حكي بيتحوّل لمشكلة وخناق...',
        relatedEn: '14 people related',
        relatedAr: '١٤ شخص حسّوا بنفس الشي',
        repliesEn: '3 gentle replies',
        repliesAr: '٣ ردود لطيفة',
      },
      {
        id: 3,
        category: 'money',
        categoryLabelEn: 'Money',
        categoryLabelAr: 'المال',
        titleEn: '“Bills are crushing us”',
        titleAr: '«الفواتير عم تكسرنا»',
        excerptEn: 'Rent, groceries, school, car… everything is going up. I smile in front of my kids but inside I’m panicking...',
        excerptAr: 'إيجار، أكل، مدرسة، سيارة… كل شي عم يغلى. بضحك قدام ولادي بس من جوّا عم بخاف...',
        relatedEn: '31 people related',
        relatedAr: '٣١ شخص حسّوا بنفس الشي',
        repliesEn: '7 gentle replies',
        repliesAr: '٧ ردود لطيفة',
      }
    ];

    let activeFilter = 'all';

    function goToStory(id) {
      window.location.href = `story.html?id=${encodeURIComponent(id)}`;
    }

    function renderStories(filter = 'all') {
      const grid = document.getElementById('stories-grid');
      const empty = document.getElementById('empty-state');
      if (!grid || !empty) return;

      grid.innerHTML = '';

      const filtered = (filter === 'all')
        ? exampleStories
        : exampleStories.filter(s => s.category === filter);

      if (!filtered.length) {
        empty.style.display = 'block';
        return;
      }

      empty.style.display = 'none';

      filtered.forEach(story => {
        const cat = (currentLang === 'ar') ? story.categoryLabelAr : story.categoryLabelEn;
        const title = (currentLang === 'ar') ? story.titleAr : story.titleEn;
        const excerpt = (currentLang === 'ar') ? story.excerptAr : story.excerptEn;
        const related = (currentLang === 'ar') ? story.relatedAr : story.relatedEn;
        const replies = (currentLang === 'ar') ? story.repliesAr : story.repliesEn;

        const card = document.createElement('div');
        card.className = 'story-card';
        card.setAttribute('role', 'link');
        card.setAttribute('tabindex', '0');
        card.setAttribute('aria-label', title);

        card.innerHTML = `
          <div class="story-category">${cat}</div>
          <div class="story-title">${title}</div>
          <div class="story-excerpt">${excerpt}</div>
          <div class="story-footer">
            <span><span class="dot"></span>${related}</span>
            <span><span class="dot"></span>${replies}</span>
          </div>
        `;

        // Bullet-proof click handling
        card.addEventListener('click', () => goToStory(story.id));
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            goToStory(story.id);
          }
        });

        grid.appendChild(card);
      });
    }

    function setActiveFilter(filter) {
      activeFilter = filter;
      document.querySelectorAll('.filter-pill').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === filter);
      });
      renderStories(filter);
    }

    document.querySelectorAll('.filter-pill').forEach(btn => {
      btn.addEventListener('click', () => setActiveFilter(btn.dataset.filter));
    });

    refreshUserLabel(currentLang);
    renderStories(activeFilter);
  })();
</script>
</body>
</html>
