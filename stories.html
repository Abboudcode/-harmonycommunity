<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <title>Stories ‚Äì Harmony Community</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="Read real family stories from people like you ‚Äì and see you‚Äôre not alone."
  />

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      --bg: #f5f7fb;
      --bg-card: #ffffff;
      --primary: #4b6fff;
      --primary-soft: #e2e7ff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-soft: #e5e7eb;
      --accent: #10b981;
      --danger: #ef4444;
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-soft: 0 14px 35px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #eef2ff, #f9fafb 40%);
      color: var(--text-main);
      line-height: 1.6;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .max-w {
      max-width: 1080px;
      margin: 0 auto;
      padding: 0 1.25rem;
    }

    /* HEADER */

    header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(16px);
      background: linear-gradient(180deg, #050817, #0f172a);
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.8rem 0;
      gap: 1rem;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .logo-wrapper {
      display: flex;
      align-items: center;
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 0.95rem;
      color: #e5e7eb;
    }

    .nav-links a {
      padding: 0.3rem 0.6rem;
      border-radius: 999px;
      transition: background 0.2s, color 0.2s;
    }

    .nav-links a:hover {
      background: rgba(148, 163, 184, 0.22);
      color: #ffffff;
    }

    .nav-links a.active {
      background: rgba(129, 140, 248, 0.38);
      color: #ffffff;
    }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .nav-ghost {
      font-size: 0.9rem;
      color: #cbd5f5;
      white-space: nowrap;
    }

    .language-select {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.8);
      color: #e5e7eb;
      font-size: 0.8rem;
      padding: 0.25rem 0.7rem;
      outline: none;
      cursor: pointer;
    }

    .language-select option {
      color: #111827;
      background: #ffffff;
    }

    @media (max-width: 720px) {
      .nav-links {
        display: none;
      }
    }

    /* BUTTONS */

    .btn-primary {
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: #fff;
      border-radius: 999px;
      padding: 0.65rem 1.4rem;
      font-size: 0.95rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(79, 70, 229, 0.35);
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.1s ease;
      white-space: nowrap;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 35px rgba(79, 70, 229, 0.45);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3);
      opacity: 0.9;
    }

    .btn-secondary {
      background: #eef2ff;
      color: #4f46e5;
      border-radius: 999px;
      padding: 0.55rem 1.2rem;
      font-size: 0.92rem;
      font-weight: 500;
      border: 1px solid #c7d2fe;
      cursor: pointer;
      transition: background 0.15s, border-color 0.15s;
    }

    .btn-secondary:hover {
      background: #e0e7ff;
      border-color: #a5b4fc;
    }

    /* LAYOUT */

    main {
      padding: 2.6rem 0 2rem;
    }

    .page-header {
      text-align: center;
      margin-bottom: 1.8rem;
    }

    .page-header h1 {
      font-size: 1.7rem;
      margin-bottom: 0.4rem;
    }

    .page-header p {
      font-size: 0.95rem;
      color: var(--text-muted);
      max-width: 640px;
      margin: 0 auto;
    }

    .actions-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.75rem;
      margin: 1.6rem 0 1.2rem;
    }

    .filters-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.8rem;
    }

    .filter-pill {
      padding: 0.2rem 0.9rem;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      font-size: 0.85rem;
      color: #4b5563;
      cursor: pointer;
      transition: background 0.15s, color 0.15s, border-color 0.15s;
    }

    .filter-pill.active {
      background: #4f46e5;
      border-color: #4f46e5;
      color: #ffffff;
    }

    /* STORIES GRID */

    .stories-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 1.1rem;
      margin-bottom: 1.5rem;
    }

    @media (min-width: 900px) {
      .stories-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .story-card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 1.2rem 1.15rem;
      border: 1px solid var(--border-soft);
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.04);
      transition: box-shadow 0.16s ease, transform 0.16s ease,
        border-color 0.16s ease;
    }

    .story-card:hover {
      box-shadow: var(--shadow-soft);
      transform: translateY(-2px);
      border-color: #e5e7eb;
    }

    .story-category {
      display: inline-flex;
      align-items: center;
      font-size: 0.78rem;
      font-weight: 500;
      border-radius: 999px;
      padding: 0.18rem 0.7rem;
      background: #eef2ff;
      color: #4f46e5;
      margin-bottom: 0.35rem;
    }

    .story-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.3rem;
    }

    .story-meta {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-bottom: 0.4rem;
    }

    .story-content {
      font-size: 0.9rem;
      color: #374151;
      margin-bottom: 0.7rem;
    }

    .story-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: #6b7280;
    }

    .story-footer span {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    .story-footer .dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: #d1d5db;
      display: inline-block;
    }

    .empty-state {
      text-align: center;
      font-size: 0.92rem;
      color: var(--text-muted);
      padding: 1.8rem 1rem 0.2rem;
    }

    footer {
      padding: 1rem 0 1.5rem;
      font-size: 0.8rem;
      color: var(--text-muted);
      text-align: center;
      margin-top: auto;
    }

    @media (max-width: 640px) {
      main {
        padding-top: 2.2rem;
      }

      .nav {
        padding: 0.6rem 0;
      }
    }
  </style>
</head>
<body>
<div class="page">
  <!-- HEADER -->
  <header>
    <div class="max-w nav">
      <div class="nav-left">
        <div class="logo-wrapper">
          <!-- Arc + heartbeat + Harmony text logo -->
          <svg
            width="180"
            height="40"
            viewBox="0 0 180 40"
            xmlns="http://www.w3.org/2000/svg"
            aria-label="Harmony logo"
            role="img"
          >
            <!-- Arc -->
            <path
              d="M10 22 C25 5, 55 5, 70 22"
              fill="none"
              stroke="#40cbb4"
              stroke-width="3"
              stroke-linecap="round"
            />
            <!-- Heartbeat / wave -->
            <path
              d="M12 22 L22 22 L27 15 L33 30 L38 22 L68 22"
              fill="none"
              stroke="#f5c451"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <!-- Text -->
            <text
              x="78"
              y="27"
              font-family="Inter, system-ui, sans-serif"
              font-size="18"
              font-weight="600"
              fill="#ffffff"
            >
              Harmony
            </text>
          </svg>
        </div>
      </div>

      <nav class="nav-links">
        <a href="index.html"
           data-en="Home"
           data-ar="ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©">Home</a>
        <a href="stories.html" class="active"
           data-en="Stories"
           data-ar="ÿßŸÑŸÇÿµÿµ">Stories</a>
        <a href="share.html"
           data-en="Share a Story"
           data-ar="ÿ¥ÿßÿ±ŸÉ ŸÇÿµÿ©">Share a Story</a>
        <a href="signin.html"
           data-en="Sign In"
           data-ar="ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ">Sign In</a>
        <a href="about.html"
           data-en="About"
           data-ar="ÿπŸÜ Ÿáÿßÿ±ŸÖŸàŸÜŸä">About</a>
        <a href="faq.html"
           data-en="FAQ"
           data-ar="ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ¥ÿßÿ¶ÿπÿ©">FAQ</a>
        <a href="contact.html"
           data-en="Contact"
           data-ar="ÿßÿ™ÿµÿßŸÑ">Contact</a>
      </nav>

      <div class="nav-right">
        <select id="language-select" class="language-select" aria-label="Choose language">
          <option value="en">English</option>
          <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
        </select>
        <div class="nav-ghost" id="nav-auth-label"
             data-en="Not signed in"
             data-ar="ÿ∫Ÿäÿ± ŸÖÿ≥ÿ¨ŸëŸÑ ÿßŸÑÿØÿÆŸàŸÑ">
          Not signed in
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main>
    <div class="max-w">
      <div class="page-header">
        <h1
          data-en="Stories from people like you"
          data-ar="ŸÇÿµÿµ ŸÖŸÜ ŸÜÿßÿ≥ ŸÖÿ´ŸÑŸÉ ÿ™ŸÖÿßŸÖÿßŸã"
        >
          Stories from people like you
        </h1>
        <p
          data-en="In the full Harmony app, this page shows real stories from the community. Below you can already see the first real posts coming from the database."
          data-ar="ŸÅŸä ÿ™ÿ∑ÿ®ŸäŸÇ Ÿáÿßÿ±ŸÖŸàŸÜŸä ÿßŸÑŸÉÿßŸÖŸÑÿå Ÿáÿ∞Ÿá ÿßŸÑÿµŸÅÿ≠ÿ© ÿ®ÿ™ÿπÿ±ÿ∂ ŸÇÿµÿµ ÿ≠ŸÇŸäŸÇŸäÿ© ŸÖŸÜ ÿßŸÑŸÖÿ¨ÿ™ŸÖÿπ. ÿ™ÿ≠ÿ™ ÿ±ÿ≠ ÿ™ÿ®ŸÑŸëÿ¥ ÿ™ÿ¥ŸàŸÅ ÿ£ŸàŸÑ ÿßŸÑŸÇÿµÿµ ÿßŸÑÿ≠ŸÇŸäŸÇŸäÿ© ÿßŸÑŸÇÿßÿØŸÖÿ© ŸÖŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™."
        >
          In the full Harmony app, this page shows real stories from the community. Below you can already see the first real posts coming from the database.
        </p>
      </div>

      <div class="actions-row">
        <a href="share.html">
          <button
            class="btn-primary"
            data-en="Share your own story"
            data-ar="ÿ•ÿ≠ŸÉŸä ŸÇÿµÿ™ŸÉ ÿ•ŸÜÿ™"
          >
            Share your own story
          </button>
        </a>
        <a href="signin.html">
          <button
            class="btn-secondary"
            data-en="Sign in to save & react"
            data-ar="ÿ≥ÿ¨ŸëŸÑ ÿØÿÆŸàŸÑ ÿ≠ÿ™Ÿâ ÿ™ÿ≠ŸÅÿ∏ Ÿàÿ™ÿ±ÿØ"
          >
            Sign in to save & react
          </button>
        </a>
      </div>

      <div class="filters-row">
        <button class="filter-pill active" data-filter="All" data-en="All" data-ar="ÿßŸÑŸÉŸÑ">All</button>
        <button class="filter-pill" data-filter="Kids" data-en="Kids" data-ar="ÿßŸÑÿ£ÿ∑ŸÅÿßŸÑ">Kids</button>
        <button class="filter-pill" data-filter="Teens" data-en="Teens" data-ar="ÿßŸÑŸÖÿ±ÿßŸáŸÇŸäŸÜ">Teens</button>
        <button class="filter-pill" data-filter="Adult" data-en="Adult" data-ar="ÿßŸÑŸÉÿ®ÿßÿ±">Adult</button>
        <button class="filter-pill" data-filter="Marriage" data-en="Marriage" data-ar="ÿßŸÑÿ≤Ÿàÿßÿ¨">Marriage</button>
        <button class="filter-pill" data-filter="Finance" data-en="Finance" data-ar="ÿßŸÑŸÖÿßŸÑ">Finance</button>
      </div>

      <!-- STORIES RENDER HERE -->
      <div id="stories-list" class="stories-grid"></div>

      <div id="stories-empty" class="empty-state" style="display:none;"
           data-en="No real stories yet. Be the first person to share what‚Äôs on your heart."
           data-ar="ŸÑÿ≥ÿß ŸÖÿß ŸÅŸä ŸÇÿµÿµ ÿ≠ŸÇŸäŸÇŸäÿ©. ŸÉŸàŸÜ ÿ£ŸàŸÑ ÿ¥ÿÆÿµ Ÿäÿ¥ÿßÿ±ŸÉ ÿßŸÑŸÑŸä ÿ®ŸÇŸÑÿ®ŸÉ.">
        No real stories yet. Be the first person to share what‚Äôs on your heart.
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer>
    Harmony Community ¬© 2025
  </footer>
</div>

<!-- Supabase client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  (function () {
    const LANG_KEY = 'harmony_lang';

    const langSelect = document.getElementById('language-select');
    const navAuthLabel = document.getElementById('nav-auth-label');
    const storiesList = document.getElementById('stories-list');
    const storiesEmpty = document.getElementById('stories-empty');
    const filterButtons = document.querySelectorAll('.filter-pill');

    let currentLang = 'en';
    let allStories = [];
    let currentFilter = 'All';

    function getInitialLang() {
      try {
        const saved = localStorage.getItem(LANG_KEY);
        if (saved === 'ar' || saved === 'en') return saved;
      } catch (e) {
        // ignore
      }
      return 'en';
    }

    function applyLanguage(lang) {
      currentLang = lang;

      const elements = document.querySelectorAll('[data-en]');
      elements.forEach(el => {
        const en = el.getAttribute('data-en');
        const ar = el.getAttribute('data-ar') || en;
        el.innerHTML = (lang === 'ar') ? ar : en;
      });

      document.documentElement.lang = (lang === 'ar') ? 'ar' : 'en';
      document.documentElement.dir  = (lang === 'ar') ? 'rtl' : 'ltr';
    }

    function formatDate(dateStr) {
      if (!dateStr) return '';
      const d = new Date(dateStr);
      return d.toLocaleDateString(undefined, {
        month: 'short',
        day: 'numeric',
        year: 'numeric'
      });
    }

    function escapeHTML(str) {
      if (!str) return '';
      return str
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
    }

    function renderStories() {
      if (!storiesList) return;

      const filtered = allStories.filter(story => {
        if (currentFilter === 'All') return true;
        return story.category === currentFilter;
      });

      storiesList.innerHTML = '';

      if (!filtered.length) {
        if (storiesEmpty) storiesEmpty.style.display = 'block';
        return;
      } else {
        if (storiesEmpty) storiesEmpty.style.display = 'none';
      }

      filtered.forEach(story => {
        const who =
          story.is_anonymous
            ? (currentLang === 'ar' ? 'ŸÖÿ¨ŸáŸàŸÑ' : 'Anonymous')
            : (currentLang === 'ar' ? 'ÿπÿ∂Ÿà ŸÖŸÜ ÿßŸÑŸÖÿ¨ÿ™ŸÖÿπ' : 'Community member');

        const shortContent = story.content && story.content.length > 260
          ? story.content.slice(0, 260) + '‚Ä¶'
          : (story.content || '');

        const card = document.createElement('article');
        card.className = 'story-card';
        card.innerHTML = `
          <div class="story-category">${escapeHTML(story.category || '')}</div>
          <div class="story-title">${escapeHTML(story.title || '')}</div>
          <div class="story-meta">
            ${escapeHTML(who)} ‚Ä¢ ${formatDate(story.created_at)}
          </div>
          <div class="story-content">
            ${escapeHTML(shortContent)}
          </div>
          <div class="story-footer">
            <span>
              <span class="dot"></span>
              ${currentLang === 'ar'
                ? 'Ÿáÿ∞ÿß ŸÖÿ´ÿßŸÑ ÿ®ÿ≥Ÿäÿ∑ ŸÑŸÉŸäŸÅ ÿ±ÿ≠ ÿ™Ÿèÿπÿ±ÿ∂ ÿßŸÑŸÇÿµÿµ ÿßŸÑÿ≠ŸÇŸäŸÇŸäÿ©'
                : 'Preview of how real stories will appear'}
            </span>
            <span>
              üíõ ${currentLang === 'ar' ? 'ÿ£ŸÜÿ™ ŸÑÿ≥ÿ™ Ÿàÿ≠ÿØŸÉ' : 'You‚Äôre not alone'}
            </span>
          </div>
        `;
        storiesList.appendChild(card);
      });
    }

    // Category filter buttons
    filterButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        filterButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFilter = btn.getAttribute('data-filter') || 'All';
        renderStories();
      });
    });

    // === Supabase setup ===
    const SUPABASE_URL = 'https://tnohzvrpqiaiupwyaxcp.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_BkvdSI8x7RxczomMIRAbOA_MLTw8g8K';

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function refreshUserLabel(langOverride) {
      const lang = langOverride || currentLang;

      const { data, error } = await supabase.auth.getUser();
      if (error || !data || !data.user) {
        if (navAuthLabel) {
          const en = navAuthLabel.getAttribute('data-en') || 'Not signed in';
          const ar = navAuthLabel.getAttribute('data-ar') || en;
          navAuthLabel.textContent = (lang === 'ar') ? ar : en;
        }
        return;
      }

      const user = data.user;
      const meta = user.user_metadata || {};
      const displayName = meta.display_name || user.email;
      const alwaysAnon = !!meta.always_anonymous;

      let label;
      if (alwaysAnon) {
        label = (lang === 'ar')
          ? 'ŸÖÿ≥ÿ¨ŸëŸÑ: ŸÖÿ¨ŸáŸàŸÑ (ÿßŸÑÿßÿ≥ŸÖ ŸÖÿÆŸÅŸä)'
          : 'Signed in: Anonymous (name hidden)';
      } else {
        label = (lang === 'ar')
          ? 'ŸÖÿ≥ÿ¨ŸëŸÑ: ' + displayName
          : 'Signed in: ' + displayName;
      }

      if (navAuthLabel) {
        navAuthLabel.textContent = label;
      }
    }

    async function loadStories() {
      try {
        const { data, error } = await supabase
          .from('stories')
          .select('id, title, content, category, is_anonymous, created_at')
          .order('created_at', { ascending: false })
          .limit(50);

        if (error) {
          console.error('Error loading stories:', error);
          if (storiesEmpty) {
            storiesEmpty.style.display = 'block';
            storiesEmpty.textContent =
              currentLang === 'ar'
                ? 'ÿµÿßÿ± ÿÆÿ∑ÿ£ ÿ®ÿ≥Ÿäÿ∑ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇÿµÿµ.'
                : 'Something went wrong while loading stories.';
          }
          return;
        }

        allStories = data || [];
        renderStories();
      } catch (e) {
        console.error(e);
      }
    }

    // === Init language from localStorage ===
    const initialLang = getInitialLang();
    applyLanguage(initialLang);

    if (langSelect) {
      langSelect.value = initialLang;
      langSelect.addEventListener('change', () => {
        const lang = langSelect.value;
        try {
          localStorage.setItem(LANG_KEY, lang);
        } catch (e) {}
        applyLanguage(lang);
        refreshUserLabel(lang);
        renderStories();
      });
    }

    // Initial data + auth label
    refreshUserLabel(initialLang);
    loadStories();
  })();
</script>
</body>
</html>
