<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <title>Sign in to Harmony – Safe Family Stories</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="Create a Harmony account or sign in to share your family story, with your name or as Anonymous."
  />

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      --bg: #f5f7fb;
      --bg-card: #ffffff;
      --primary: #4b6fff;
      --primary-soft: #e2e7ff;
      --text-main: #1f2933;
      --text-muted: #6b7280;
      --border-soft: #e5e7eb;
      --accent: #10b981;
      --danger: #ef4444;
      --radius-lg: 16px;
      --radius-md: 10px;
      --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #eef2ff, #f9fafb 40%);
      color: var(--text-main);
      line-height: 1.6;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .max-w {
      max-width: 1080px;
      margin: 0 auto;
      padding: 0 1.25rem;
    }

    /* HEADER / NAV */

    header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(16px);
      background: linear-gradient(180deg, #050817, #0f172a);
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.8rem 0;
      gap: 1rem;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .logo-wrapper {
      display: flex;
      align-items: center;
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 0.95rem;
      color: #e5e7eb;
    }

    .nav-links a {
      padding: 0.3rem 0.6rem;
      border-radius: 999px;
      transition: background 0.2s, color 0.2s;
    }

    .nav-links a:hover {
      background: rgba(148, 163, 184, 0.22);
      color: #ffffff;
    }

    .nav-links a.active {
      background: rgba(129, 140, 248, 0.35);
      color: #ffffff;
    }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .nav-ghost {
      font-size: 0.9rem;
      color: #cbd5f5;
      white-space: nowrap;
    }

    .language-select {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.8);
      color: #e5e7eb;
      font-size: 0.8rem;
      padding: 0.25rem 0.7rem;
      outline: none;
      cursor: pointer;
    }

    .language-select option {
      color: #111827;
      background: #ffffff;
    }

    @media (max-width: 720px) {
      .nav-links {
        display: none;
      }
    }

    /* BUTTONS */

    .btn-primary {
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: #fff;
      border-radius: 999px;
      padding: 0.6rem 1.3rem;
      font-size: 0.95rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(79, 70, 229, 0.35);
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.1s ease;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 35px rgba(79, 70, 229, 0.45);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3);
      opacity: 0.9;
    }

    .btn-secondary {
      background: #eef2ff;
      color: #4f46e5;
      border-radius: 999px;
      padding: 0.55rem 1.2rem;
      font-size: 0.92rem;
      font-weight: 500;
      border: 1px solid #c7d2fe;
      cursor: pointer;
      transition: background 0.15s, border-color 0.15s;
    }

    .btn-secondary:hover {
      background: #e0e7ff;
      border-color: #a5b4fc;
    }

    /* LAYOUT */

    main {
      padding: 2.8rem 0 2rem;
    }

    .two-col {
      display: grid;
      grid-template-columns: minmax(0, 1.8fr) minmax(0, 1.5fr);
      gap: 1.8rem;
    }

    @media (max-width: 900px) {
      .two-col {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 1.6rem 1.4rem;
      border: 1px solid var(--border-soft);
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.03);
      transition: box-shadow 0.15s ease, transform 0.15s ease, border-color 0.15s ease;
    }

    .card:hover {
      box-shadow: 0 16px 35px rgba(15, 23, 42, 0.07);
      transform: translateY(-2px);
      border-color: #e5e7eb;
    }

    .card h3 {
      font-size: 1.1rem;
      margin-bottom: 0.4rem;
    }

    .card p.sub {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 1rem;
    }

    .field {
      margin-bottom: 0.9rem;
      font-size: 0.9rem;
    }

    .field label {
      display: block;
      margin-bottom: 0.25rem;
      font-weight: 500;
    }

    .field input[type="text"],
    .field input[type="email"],
    .field input[type="password"] {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      padding: 0.55rem 0.7rem;
      font-family: inherit;
      font-size: 0.9rem;
      transition: border-color 0.12s ease, box-shadow 0.12s ease;
    }

    .field input:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.25);
    }

    .field-inline {
      display: flex;
      align-items: flex-start;
      gap: 0.45rem;
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 0.8rem;
    }

    .field-inline input[type="checkbox"] {
      margin-top: 0.1rem;
    }

    .note {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.5rem;
    }

    .page-title-block {
      max-width: 640px;
      margin: 0 auto 1.8rem;
      text-align: center;
    }

    .page-title-block h1 {
      font-size: 1.6rem;
      margin-bottom: 0.4rem;
    }

    .page-title-block p {
      font-size: 0.95rem;
      color: var(--text-muted);
    }

    .status-ok {
      color: #16a34a;
    }

    .status-error {
      color: var(--danger);
    }

    footer {
      padding: 1rem 0 1.5rem;
      font-size: 0.8rem;
      color: var(--text-muted);
      text-align: center;
      margin-top: auto;
    }

    @media (max-width: 640px) {
      main {
        padding-top: 2.2rem;
      }

      .card {
        padding: 1.2rem 1.1rem;
      }

      .nav {
        padding: 0.6rem 0;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- HEADER -->
    <header>
      <div class="max-w nav">
        <div class="nav-left">
          <div class="logo-wrapper">
            <!-- Arc + heartbeat + Harmony text logo -->
            <svg
              width="180"
              height="40"
              viewBox="0 0 180 40"
              xmlns="http://www.w3.org/2000/svg"
              aria-label="Harmony logo"
              role="img"
            >
              <!-- Arc -->
              <path
                d="M10 22 C25 5, 55 5, 70 22"
                fill="none"
                stroke="#40cbb4"
                stroke-width="3"
                stroke-linecap="round"
              />
              <!-- Heartbeat / wave -->
              <path
                d="M12 22 L22 22 L27 15 L33 30 L38 22 L68 22"
                fill="none"
                stroke="#f5c451"
                stroke-width="3"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <!-- Text -->
              <text
                x="78"
                y="27"
                font-family="Inter, system-ui, sans-serif"
                font-size="18"
                font-weight="600"
                fill="#ffffff"
              >
                Harmony
              </text>
            </svg>
          </div>
        </div>

        <nav class="nav-links">
          <a href="index.html">Home</a>
          <a href="stories.html">Stories</a>
          <a href="share.html">Share a Story</a>
          <a href="signin.html" class="active">Sign In</a>
          <a href="about.html">About</a>
          <a href="faq.html">FAQ</a>
          <a href="contact.html">Contact</a>
        </nav>

        <div class="nav-right">
          <select id="language-select" class="language-select" aria-label="Choose language">
            <option value="en">English</option>
            <option value="ar">العربية</option>
          </select>
          <div class="nav-ghost" id="nav-auth-label">
            Not signed in
          </div>
        </div>
      </div>
    </header>

    <!-- MAIN -->
    <main>
      <div class="max-w page-title-block">
        <h1 data-en="Sign in to Harmony" data-ar="سجّل الدخول إلى هارموني">
          Sign in to Harmony
        </h1>
        <p
          data-en="Create a free account or sign in to share your story with your name or as Anonymous. Your email stays private."
          data-ar="أنشئ حساب مجاني أو سجّل الدخول لتشارك قصتك باسمك أو كمجهول. إيميلك يبقى خاص."
        >
          Create a free account or sign in to share your story with your name or as Anonymous. Your email stays private.
        </p>
      </div>

      <section>
        <div class="max-w two-col">
          <!-- SIGN UP -->
          <div class="card">
            <h3 data-en="Create your Harmony account" data-ar="أنشئ حسابك في هارموني">
              Create your Harmony account
            </h3>
            <p class="sub"
               data-en="Use this form to create a real Harmony account. We only ask for email, password and an optional name."
               data-ar="استخدم هذا النموذج لإنشاء حساب حقيقي في هارموني. نحتاج فقط الإيميل وكلمة السر، والاسم اختياري.">
              Use this form to create a real Harmony account. We only ask for email,
              password and an optional name.
            </p>

            <form id="signup-form">
              <div class="field">
                <label for="signup-email" data-en="Email" data-ar="الإيميل">Email</label>
                <input id="signup-email" type="email" required placeholder="you@example.com" />
              </div>

              <div class="field">
                <label for="signup-password" data-en="Password" data-ar="كلمة السر">Password</label>
                <input id="signup-password" type="password" required minlength="6" placeholder="At least 6 characters" />
              </div>

              <div class="field">
                <label for="signup-name" data-en="Name or nickname (optional)" data-ar="الاسم أو لقب (اختياري)">
                  Name or nickname (optional)
                </label>
                <input id="signup-name" type="text" placeholder="Mohamad, Anonymous Dad, Tired Mama…" />
              </div>

              <div class="field-inline">
                <input id="signup-anon" type="checkbox" />
                <label for="signup-anon">
                  <strong data-en="Always show me as Anonymous" data-ar="دائماً إظهرني كمجهول">Always show me as Anonymous</strong><br />
                  <small
                    data-en="If checked, Harmony will hide your name and only show “Anonymous” when you post."
                    data-ar="إذا فعّلت هذا الخيار، هارموني رح تخفي اسمك وتعرض فقط &quot;مجهول&quot; عند النشر."
                  >
                    If checked, Harmony will hide your name and only show “Anonymous”
                    when you post.
                  </small>
                </label>
              </div>

              <button type="submit" class="btn-primary"
                      data-en="Create account"
                      data-ar="إنشاء حساب">
                Create account
              </button>
            </form>
          </div>

          <!-- SIGN IN -->
          <div class="card">
            <h3 data-en="Sign in to your account" data-ar="سجّل الدخول إلى حسابك">
              Sign in to your account
            </h3>
            <p class="sub"
               data-en="Already created an account before? Use the same email and password to sign in."
               data-ar="عندك حساب من قبل؟ استخدم نفس الإيميل وكلمة السر لتسجّل الدخول.">
              Already created an account before? Use the same email and password to sign in.
            </p>

            <form id="signin-form">
              <div class="field">
                <label for="signin-email" data-en="Email" data-ar="الإيميل">Email</label>
                <input id="signin-email" type="email" required placeholder="you@example.com" />
              </div>

              <div class="field">
                <label for="signin-password" data-en="Password" data-ar="كلمة السر">Password</label>
                <input id="signin-password" type="password" required minlength="6" />
              </div>

              <button type="submit" class="btn-secondary"
                      data-en="Sign in"
                      data-ar="تسجيل الدخول">
                Sign in
              </button>
            </form>

            <p id="current-user-label"
               class="note"
               style="margin-top:1rem;"
               data-en="Status: not signed in."
               data-ar="الحالة: غير مسجّل الدخول.">
              Status: not signed in.
            </p>

            <p id="auth-status" class="note" style="margin-top:0.4rem;"></p>

            <p class="note" style="margin-top:0.6rem;"
               data-en="If email confirmation is enabled, you may need to click the link in your inbox before you can sign in."
               data-ar="إذا كان تفعيل الإيميل مفعّل، ممكن تحتاج تضغط على الرابط في بريدك قبل ما تقدر تسجّل الدخول.">
              If email confirmation is enabled, you may need to click the link in your inbox before you can sign in.
            </p>
          </div>
        </div>
      </section>
    </main>

    <!-- FOOTER -->
    <footer>
      Harmony Community © 2025
    </footer>
  </div>

  <!-- Supabase client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    (function () {
      const langSelect = document.getElementById('language-select');
      const navAuthLabel = document.getElementById('nav-auth-label');

      function applyLanguage(lang) {
        const elements = document.querySelectorAll('[data-en]');
        elements.forEach(el => {
          const en = el.getAttribute('data-en');
          const ar = el.getAttribute('data-ar') || en;
          el.innerHTML = lang === 'ar' ? ar : en;
        });

        document.documentElement.lang = lang === 'ar' ? 'ar' : 'en';
        document.documentElement.dir  = lang === 'ar' ? 'rtl' : 'ltr';
      }

      // Always start in English
      applyLanguage('en');
      langSelect.value = 'en';

      langSelect.addEventListener('change', () => {
        const lang = langSelect.value;
        applyLanguage(lang);
      });

      // === Supabase auth ===
      const SUPABASE_URL = 'https://tnohzvrpqiaiupwyaxcp.supabase.co';
      const SUPABASE_ANON_KEY = 'sb_publishable_BkvdSI8x7RxczomMIRAbOA_MLTw8g8K';

      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      const signupForm = document.getElementById('signup-form');
      const signinForm = document.getElementById('signin-form');
      const authStatus = document.getElementById('auth-status');
      const currentUserLabel = document.getElementById('current-user-label');

      function setStatus(message, isError) {
        if (!authStatus) return;
        authStatus.textContent = message || '';
        authStatus.classList.remove('status-ok', 'status-error');
        if (!message) return;
        authStatus.classList.add(isError ? 'status-error' : 'status-ok');
      }

      function updateNavLabel(text) {
        if (navAuthLabel) {
          navAuthLabel.textContent = text;
        }
      }

      async function refreshUserLabel() {
        const { data, error } = await supabase.auth.getUser();
        if (error || !data.user) {
          if (currentUserLabel) {
            currentUserLabel.textContent = 'Status: not signed in.';
          }
          updateNavLabel('Not signed in');
          return;
        }

        const user = data.user;
        const meta = user.user_metadata || {};
        const displayName = meta.display_name || user.email;
        const alwaysAnon = !!meta.always_anonymous;

        let label;
        if (alwaysAnon) {
          label = 'Signed in: Anonymous (name hidden)';
        } else {
          label = 'Signed in: ' + displayName;
        }

        if (currentUserLabel) {
          currentUserLabel.textContent = label;
        }
        updateNavLabel(label);
      }

      if (signupForm) {
        signupForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          setStatus('Creating your account…', false);

          const email = document.getElementById('signup-email').value.trim();
          const password = document.getElementById('signup-password').value;
          const name = document.getElementById('signup-name').value.trim();
          const alwaysAnon = document.getElementById('signup-anon').checked;

          const { error } = await supabase.auth.signUp({
            email,
            password,
            options: {
              data: {
                display_name: name,
                always_anonymous: alwaysAnon
              }
            }
          });

          if (error) {
            setStatus('Error: ' + error.message, true);
          } else {
            setStatus('Account created! Check your email if confirmation is required, then sign in below.', false);
            signupForm.reset();
            refreshUserLabel();
          }
        });
      }

      if (signinForm) {
        signinForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          setStatus('Signing you in…', false);

          const email = document.getElementById('signin-email').value.trim();
          const password = document.getElementById('signin-password').value;

          const { data, error } = await supabase.auth.signInWithPassword({
            email,
            password
          });

          if (error) {
            setStatus('Error: ' + error.message, true);
          } else {
            setStatus('Signed in successfully.', false);
            signinForm.reset();
            refreshUserLabel();
          }
        });
      }

      // On first load, check if already signed in
      refreshUserLabel();
    })();
  </script>
</body>
</html>
